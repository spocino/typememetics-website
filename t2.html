<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Old Timey Typewriter</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400&family=Special+Elite&display=swap" rel="stylesheet">
    <style>
        :root {
            --paper-color: #f1e9d2;
            --ink-color: #3a3a3a;
            --background-color: #2c2c2c;
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: 'Special Elite', monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--background-color);
            color: var(--ink-color);
            padding: 1rem;
            overflow: hidden;
        }

        .paper {
            aspect-ratio: 8.5 / 11;
            height: 95vh;
            max-width: 95vw;
            container-type: inline-size;
            container-name: paper;
            background-color: var(--paper-color);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
            position: relative;
            display: flex;
            flex-direction: column;
            padding: 5cqw 6cqw;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
        }

        .paper::before, .paper::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        @media (hover: hover) and (pointer: fine) {
            .paper { cursor: zoom-in; }
            .paper.zoomed {
                transform: scale(1.2);
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.6);
                z-index: 10;
                cursor: zoom-out;
            }
        }

        .letterhead, .page-footer, #text-container {
            position: relative;
            z-index: 2;
        }

        .letterhead, .page-footer {
            font-family: 'Oswald', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #5a5245;
            text-shadow: 0px 0px 1px rgba(0,0,0,0.2);
        }

        .letterhead {
            display: flex;
            align-items: center;
            gap: 2.5cqw;
            padding-bottom: 2.5cqw;
            margin-bottom: 3cqw;
            border-bottom: 1px solid rgba(0, 0, 0, 0.3);
        }

        .logo {
            width: 10cqw;
            height: 10cqw;
            flex-shrink: 0;
            filter: grayscale(1) sepia(0.4) opacity(0.7) contrast(1.2);
            mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            mask-size: cover;
        }

        .institution-details { flex-grow: 1; text-align: right; }
        .institution-details h1 { margin: 0; font-size: 2.2cqw; font-weight: 400; line-height: 1.2; }
        .institution-details p { margin: 1cqw 0 0 0; font-size: 1.6cqw; line-height: 1.4; font-style: normal; }
        #text-container { white-space: pre-wrap; word-wrap: break-word; font-size: 2.1cqw; line-height: 2; flex-grow: 1; }
        .char { display: inline-block; }
        .hit-light { opacity: 0.7; }
        .hit-medium { opacity: 0.85; }
        .hit-hard { opacity: 1; font-weight: 500; }
        .align-up { transform: translateY(-0.2cqw); }
        .align-down { transform: translateY(0.1cqw); }
        .page-footer { margin-top: 4cqw; padding-top: 2.5cqw; border-top: 1px solid rgba(0, 0, 0, 0.3); text-align: center; font-size: 1.5cqw; }
        .page-footer p { margin: 0; }

        .eye {
            position: absolute;
            width: 4cqw;
            height: 2.5cqw;
            z-index: 3;
            overflow: hidden;
            border-radius: 50%;
        }

        .eye .sclera {
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at 30% 30%, #ffffff 0%, #f8f4e6 40%, #ede5d0 100%);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: inset 0 0 3px 1px rgba(0,0,0,0.15), inset 2px 2px 4px rgba(0,0,0,0.1);
            border: 1px solid rgba(200,180,160,0.3);
        }

        .eye .iris {
            width: 65%;
            height: 65%;
            background: radial-gradient(circle at 35% 25%, 
                rgba(180, 50, 50, 0.9) 0%, 
                #a11a1a 30%, 
                #7a1515 60%, 
                #4a0d0d 100%);
            border-radius: 50%;
            box-shadow: 
                0 0 4px 1px rgba(161, 26, 26, 0.6),
                inset 0 0 3px rgba(0,0,0,0.4),
                inset 1px 1px 2px rgba(255,100,100,0.3);
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }

        .eye .iris::before {
            content: '';
            position: absolute;
            width: 80%;
            height: 80%;
            background: radial-gradient(ellipse at 40% 30%, 
                rgba(255,80,80,0.4) 0%, 
                transparent 50%);
            border-radius: 50%;
            top: 10%;
            left: 10%;
        }

        .eye .pupil {
            width: 45%;
            height: 45%;
            background: radial-gradient(circle at 30% 30%, 
                rgba(40,40,40,1) 0%, 
                #000000 70%, 
                #000000 100%);
            border-radius: 50%;
            box-shadow: inset 1px 1px 2px rgba(0,0,0,0.8);
            position: relative;
            animation: pupil-center 3s ease-in-out forwards;
            transform: translateX(-30%);
        }

        .eye .pupil::after {
            content: '';
            position: absolute;
            width: 25%;
            height: 25%;
            background: rgba(255,255,255,0.6);
            border-radius: 50%;
            top: 20%;
            left: 25%;
            filter: blur(0.5px);
        }

        @keyframes pupil-center {
            0% { transform: translateX(-30%); }
            100% { transform: translateX(0%); }
        }

        .eye .eyelid {
            position: absolute;
            left: 0;
            width: 100%;
            height: 52%;
            background: linear-gradient(to bottom, 
                rgba(241, 233, 210, 1) 0%, 
                rgba(230, 220, 200, 1) 70%, 
                rgba(210, 200, 180, 0.9) 100%);
            border-radius: 0 0 50% 50%;
        }

        .eye .eyelid.top {
            top: 0;
            animation: realistic-blink-top 5s ease-in-out forwards;
            box-shadow: 
                inset 0 -2px 3px -1px rgba(0,0,0,0.3),
                0 1px 2px rgba(0,0,0,0.2);
            border-radius: 50% 50% 0 0;
            transform-origin: bottom center;
        }

        .eye .eyelid.bottom {
            bottom: 0;
            animation: realistic-blink-bottom 5s ease-in-out forwards;
            box-shadow: 
                inset 0 2px 3px -1px rgba(0,0,0,0.3),
                0 -1px 2px rgba(0,0,0,0.2);
            border-radius: 0 0 50% 50%;
            transform-origin: top center;
        }

        @keyframes realistic-blink-top {
            0% { transform: scaleY(1) translateY(0%); }
            8% { transform: scaleY(1) translateY(-95%); }
            12% { transform: scaleY(0.8) translateY(-98%); }
            16% { transform: scaleY(1) translateY(-95%); }
            85% { transform: scaleY(1) translateY(-95%); }
            89% { transform: scaleY(0.8) translateY(-98%); }
            93% { transform: scaleY(1) translateY(-95%); }
            100% { transform: scaleY(1) translateY(0%); }
        }
        
        @keyframes realistic-blink-bottom {
            0% { transform: scaleY(1) translateY(0%); }
            8% { transform: scaleY(1) translateY(95%); }
            12% { transform: scaleY(0.8) translateY(98%); }
            16% { transform: scaleY(1) translateY(95%); }
            85% { transform: scaleY(1) translateY(95%); }
            89% { transform: scaleY(0.8) translateY(98%); }
            93% { transform: scaleY(1) translateY(95%); }
            100% { transform: scaleY(1) translateY(0%); }
        }

        #trigger-button {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 10px 20px;
            font-family: 'Oswald', sans-serif;
            background-color: #a11a1a;
            color: var(--paper-color);
            border: 1px solid #ff2a2a;
            cursor: pointer;
            z-index: 101;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 0 10px #ff2a2a;
        }

    </style>
</head>
<body>

    <div class="paper">
        <header class="letterhead">
            <img src="images/itsmr-logo.png" alt="Institution Seal" class="logo">
            <div class="institution-details">
                <h1>The Institute for Type Safe Memetic Research</h1>
                <p>Truth in Types, Safety in Thought</p>
            </div>
        </header>
        <main id="text-container"></main>
        <footer class="page-footer">
            <p>DOCUMENT #TSMR-734 // CLASSIFIED // EYES ONLY</p>
        </footer>
    </div>

    <input type="number" id="seed-input" value="12345" style="position: fixed; bottom: 70px; left: 50%; transform: translateX(-50%); padding: 10px; font-family: 'Oswald', sans-serif; background-color: #a11a1a; color: var(--paper-color); border: 1px solid #ff2a2a; z-index: 101; text-align: center;">
    <button id="trigger-button">Activate Anomaly</button>

    <script>
        function triggerEyeAnomaly() {
            const container = document.querySelector('.paper');
            if (!container) return;

            const eyePositions = [];
            const eyeSize = 4; // 4cqw width
            const minDistance = 5; // minimum distance between eyes in cqw

            function isPositionValid(x, y) {
                for (const pos of eyePositions) {
                    const distance = Math.sqrt(Math.pow(x - pos.x, 2) + Math.pow(y - pos.y, 2));
                    if (distance < minDistance) return false;
                }
                return true;
            }

            for (let i = 0; i < 50; i++) {
                let attempts = 0;
                let x, y;
                
                do {
                    x = Math.random() * (95 - eyeSize);
                    y = Math.random() * (95 - eyeSize);
                    attempts++;
                } while (!isPositionValid(x, y) && attempts < 100);

                if (attempts >= 100) continue; // Skip if can't find valid position

                eyePositions.push({x, y});

                const eye = document.createElement('div');
                eye.className = 'eye';

                const sclera = document.createElement('div');
                sclera.className = 'sclera';

                const iris = document.createElement('div');
                iris.className = 'iris';

                const pupil = document.createElement('div');
                pupil.className = 'pupil';

                const topLid = document.createElement('div');
                topLid.className = 'eyelid top';

                const bottomLid = document.createElement('div');
                bottomLid.className = 'eyelid bottom';

                iris.appendChild(pupil);
                sclera.appendChild(iris);
                eye.appendChild(sclera);
                eye.appendChild(topLid);
                eye.appendChild(bottomLid);

                eye.style.left = `${x}%`;
                eye.style.top = `${y}%`;

                const randomDelay = `${Math.random() * 2}s`;
                topLid.style.animationDelay = randomDelay;
                bottomLid.style.animationDelay = randomDelay;

                topLid.addEventListener('animationend', () => {
                    eye.remove();
                });

                container.appendChild(eye);
            }
        }


        document.addEventListener('DOMContentLoaded', makePaper);

        function makePaper() {
            function createPRNG(seed) {
                let currentSeed = seed;
                return function() {
                    currentSeed = (1664525 * currentSeed + 1013904223) % 2**32;
                    return currentSeed / 2**32;
                };
            }

            const seedInput = document.getElementById('seed-input');
            const seed = parseInt(seedInput.value) || 12345;
            const random = createPRNG(seed);
            const paperElement = document.querySelector('.paper');

            paperElement.style.backgroundImage = '';
            paperElement.style.clipPath = '';
            const existingEffects = paperElement.querySelectorAll('div:not(.letterhead):not(#text-container):not(.page-footer):not(.logo):not(.institution-details)');
            existingEffects.forEach(effect => effect.remove());

            const backgroundGradients = [];

            if (random() < 0.4) {
                const numSpots = Math.floor(random() * 3) + 1;
                for (let i = 0; i < numSpots; i++) {
                    const x = random() * 100;
                    const y = random() * 100;
                    const size = random() * 30 + 20;
                    const opacity = random() * 0.1 + 0.05;
                    backgroundGradients.push(`radial-gradient(circle at ${x}% ${y}%, rgba(210, 180, 140, ${opacity}) 0%, transparent ${size}%)`);
                }
            }

            if (random() < 0.35) {
                const numSmudges = Math.floor(random() * 4) + 1;
                for (let i = 0; i < numSmudges; i++) {
                    const x = random() * 100;
                    const y = random() * 100;
                    const sizeX = random() * 20 + 5;
                    const sizeY = random() * 20 + 5;
                    const opacity = random() * 0.05 + 0.02;
                    backgroundGradients.push(`radial-gradient(ellipse ${sizeX}% ${sizeY}% at ${x}% ${y}%, rgba(0, 0, 0, ${opacity}) 0%, transparent 70%)`);
                }
            }

            if (random() < 0.18) {
                const patchX = random() * 80 + 10;
                const patchY = random() * 80 + 10;
                const patchSize = random() * 15 + 5;
                const numSpecks = Math.floor(random() * 50) + 30;
                for (let i = 0; i < numSpecks; i++) {
                    const speckX = patchX + (random() - 0.5) * patchSize;
                    const speckY = patchY + (random() - 0.5) * patchSize;
                    const speckSize = (random() * 0.4 + 0.1).toFixed(2);
                    const opacity = random() * 0.3 + 0.2;
                    backgroundGradients.push(`radial-gradient(circle at ${speckX}% ${speckY}%, rgba(40, 50, 40, ${opacity}) 0%, transparent ${speckSize}%)`);
                }
            }

            if (backgroundGradients.length > 0) {
                paperElement.style.backgroundImage = backgroundGradients.join(', ');
            }

            if (random() < 0.25) {
                const numScuffs = Math.floor(random() * 3) + 1;
                for (let i = 0; i < numScuffs; i++) {
                    const scuff = document.createElement('div');
                    scuff.style.position = 'absolute';
                    scuff.style.top = `${random() * 80 + 10}%`;
                    scuff.style.left = `${random() * 80 + 10}%`;
                    scuff.style.width = `${random() * 30 + 10}%`;
                    scuff.style.height = `${random() * 10 + 2}%`;
                    scuff.style.backgroundColor = `rgba(0,0,0,${random() * 0.03 + 0.01})`;
                    scuff.style.transform = `rotate(${(random() - 0.5) * 45}deg)`;
                    scuff.style.maskImage = `url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E")`;
                    scuff.style.zIndex = '1';
                    paperElement.appendChild(scuff);
                }
            }

            if (random() < 0.25) {
                const numHoles = Math.floor(random() * 20) + 1;
                for (let i = 0; i < numHoles; i++) {
                    const hole = document.createElement('div');
                    hole.style.position = 'absolute';
                    hole.style.top = `${random() * 90 + 5}%`;
                    hole.style.left = `${random() * 90 + 5}%`;
                    const size = random() * 0.8 + 0.2;
                    hole.style.width = `${size}cqw`;
                    hole.style.height = `${size}cqw`;
                    hole.style.backgroundColor = 'rgba(44, 44, 44, 0.8)';
                    hole.style.borderRadius = '50%';
                    hole.style.boxShadow = 'inset 1px 1px 2px rgba(0,0,0,0.5), 0 0 1px 1px rgba(241, 233, 210, 0.5)';
                    hole.style.zIndex = '3';
                    paperElement.appendChild(hole);
                }
            }

            if (random() < 0.3) {
                const angle = random() * 180 - 90;
                const position = random() * 100;
                const opacity = random() * 0.1 + 0.05;
                addDynamicStyles(`.paper::before { background: linear-gradient(${angle}deg, rgba(0,0,0,${opacity}) ${position - 1}%, rgba(0,0,0,${opacity * 1.5}) ${position}%, rgba(255,255,255,${opacity}) ${position + 1}%, rgba(255,255,255,0) ${position + 3}%); }`);
            }

            if (random() < 0.2) {
                const edge = Math.floor(random() * 4);
                let points = ['0% 0%', '100% 0%', '100% 100%', '0% 100%'];
                const tearDepth = random() * 4 + 3;
                const tearPoints = [];
                for(let i=0; i<10; i++) {
                    const progress = (i + 1) / 11;
                    const jaggedness = (random() - 0.5) * tearDepth;
                    if (edge === 0) tearPoints.push(`${progress * 100}% ${tearDepth + jaggedness}%`);
                    if (edge === 1) tearPoints.push(`${100 - tearDepth - jaggedness}% ${progress * 100}%`);
                    if (edge === 2) tearPoints.push(`${progress * 100}% ${100 - tearDepth - jaggedness}%`);
                    if (edge === 3) tearPoints.push(`${tearDepth + jaggedness}% ${progress * 100}%`);
                }
                if (edge === 0) points.splice(1, 0, ...tearPoints.reverse());
                if (edge === 1) points.splice(2, 0, ...tearPoints);
                if (edge === 2) points.splice(3, 0, ...tearPoints);
                if (edge === 3) points.splice(4, 0, ...tearPoints.reverse());
                paperElement.style.clipPath = `polygon(${points.join(', ')})`;
            }

            const textToRender = `Dearest Reader,

The hour is late, and the world outside is hushed, save for the gentle patter of rain against the windowpane. In the soft glow of a single lamp, these keys clatter and sing, each one a small hammer striking a note in the quiet symphony of the night.

There is a certain magic in this old machine. It does not glide silently like the modern contraptions of glass and light. No, it demands effort. It speaks with a voice of ink and steel, a voice that remembers stories from a time long past.

And so, I write to you, a message from another era, carried on the ghost of a ribbon.

Yours,
A Humble Scribe`;
            const textContainer = document.getElementById('text-container');
            textContainer.innerHTML = '';
            const hitClasses = ['hit-light', 'hit-medium', 'hit-hard'];
            const alignClasses = ['align-up', 'align-down', ''];
            for (const char of textToRender) {
                if (char === '\n') { textContainer.appendChild(document.createElement('br')); }
                else if (char === ' ') { textContainer.appendChild(document.createTextNode(' ')); }
                else {
                    const span = document.createElement('span');
                    span.className = 'char';
                    span.textContent = char;
                    const randomHit = hitClasses[Math.floor(random() * hitClasses.length)];
                    span.classList.add(randomHit);
                    if (random() < 0.1) {
                        const randomAlign = alignClasses[Math.floor(random() * alignClasses.length)];
                        if (randomAlign) { span.classList.add(randomAlign); }
                    }
                    textContainer.appendChild(span);
                }
            }

            if (window.matchMedia('(hover: hover) and (pointer: fine)').matches) {
                const startZoom = (e) => { e.preventDefault(); paperElement.classList.add('zoomed'); };
                const endZoom = () => { paperElement.classList.remove('zoomed'); };
                paperElement.addEventListener('mousedown', startZoom);
                paperElement.addEventListener('mouseup', endZoom);
                paperElement.addEventListener('mouseleave', endZoom);
            }

            document.getElementById('trigger-button').addEventListener('click', triggerEyeAnomaly);
            document.getElementById('seed-input').addEventListener('input', makePaper);

            function addDynamicStyles(css) {
                const style = document.createElement('style');
                style.textContent = css;
                document.head.appendChild(style);
            }
        };
    </script>

</body>
</html>

